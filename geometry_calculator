#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Geometri HesaplayÄ±cÄ± - KapsamlÄ± Alan, Hacim ve Ã‡evre HesaplayÄ±cÄ±sÄ±
Author: Python Geometri HesaplayÄ±cÄ±
Version: 1.0
"""

import math
import json
from datetime import datetime
import os
import sys

class GeometryCalculator:
    """Geometrik ÅŸekiller iÃ§in alan, hacim ve Ã§evre hesaplayÄ±cÄ±sÄ±"""
    
    def __init__(self):
        self.pi = math.pi
        self.calculations_history = []
        print("ğŸ”¢ Geometri HesaplayÄ±cÄ± sistemi baÅŸlatÄ±ldÄ±!")
    
    def calculate_square(self, side):
        """Kare hesaplamalarÄ±"""
        if side <= 0:
            raise ValueError("Kenar uzunluÄŸu pozitif olmalÄ±dÄ±r")
        
        area = side ** 2
        perimeter = 4 * side
        
        result = {
            'shape': 'Kare',
            'inputs': {'kenar': side},
            'calculations': {
                'alan': area,
                'cevre': perimeter
            },
            'units': {
                'alan': 'cmÂ²',
                'cevre': 'cm'
            },
            'timestamp': datetime.now().isoformat()
        }
        
        self.calculations_history.append(result)
        return result
    
    def calculate_rectangle(self, length, width):
        """DikdÃ¶rtgen hesaplamalarÄ±"""
        if length <= 0 or width <= 0:
            raise ValueError("Kenar uzunluklarÄ± pozitif olmalÄ±dÄ±r")
        
        area = length * width
        perimeter = 2 * (length + width)
        
        result = {
            'shape': 'DikdÃ¶rtgen',
            'inputs': {'uzunluk': length, 'genislik': width},
            'calculations': {
                'alan': area,
                'cevre': perimeter
            },
            'units': {
                'alan': 'cmÂ²',
                'cevre': 'cm'
            },
            'timestamp': datetime.now().isoformat()
        }
        
        self.calculations_history.append(result)
        return result
    
    def calculate_circle(self, radius):
        """Daire hesaplamalarÄ±"""
        if radius <= 0:
            raise ValueError("YarÄ±Ã§ap pozitif olmalÄ±dÄ±r")
        
        area = self.pi * radius ** 2
        circumference = 2 * self.pi * radius
        
        result = {
            'shape': 'Daire',
            'inputs': {'yaricap': radius},
            'calculations': {
                'alan': area,
                'cevre': circumference
            },
            'units': {
                'alan': 'cmÂ²',
                'cevre': 'cm'
            },
            'timestamp': datetime.now().isoformat()
        }
        
        self.calculations_history.append(result)
        return result
    
    def calculate_triangle(self, base, height, side1=None, side2=None):
        """ÃœÃ§gen hesaplamalarÄ±"""
        if base <= 0 or height <= 0:
            raise ValueError("Taban ve yÃ¼kseklik pozitif olmalÄ±dÄ±r")
        
        area = (base * height) / 2
        perimeter = None
        
        if side1 and side2 and side1 > 0 and side2 > 0:
            perimeter = base + side1 + side2
        
        result = {
            'shape': 'ÃœÃ§gen',
            'inputs': {'taban': base, 'yukseklik': height},
            'calculations': {
                'alan': area,
                'cevre': perimeter if perimeter else 'HesaplanamadÄ±'
            },
            'units': {
                'alan': 'cmÂ²',
                'cevre': 'cm' if perimeter else None
            },
            'timestamp': datetime.now().isoformat()
        }
        
        if side1 and side2:
            result['inputs'].update({'kenar1': side1, 'kenar2': side2})
        
        self.calculations_history.append(result)
        return result
    
    def calculate_cube(self, side):
        """KÃ¼p hesaplamalarÄ±"""
        if side <= 0:
            raise ValueError("Kenar uzunluÄŸu pozitif olmalÄ±dÄ±r")
        
        volume = side ** 3
        surface_area = 6 * side ** 2
        
        result = {
            'shape': 'KÃ¼p',
            'inputs': {'kenar': side},
            'calculations': {
                'hacim': volume,
                'yuzey_alani': surface_area
            },
            'units': {
                'hacim': 'cmÂ³',
                'yuzey_alani': 'cmÂ²'
            },
            'timestamp': datetime.now().isoformat()
        }
        
        self.calculations_history.append(result)
        return result
    
    def calculate_sphere(self, radius):
        """KÃ¼re hesaplamalarÄ±"""
        if radius <= 0:
            raise ValueError("YarÄ±Ã§ap pozitif olmalÄ±dÄ±r")
        
        volume = (4/3) * self.pi * radius ** 3
        surface_area = 4 * self.pi * radius ** 2
        
        result = {
            'shape': 'KÃ¼re',
            'inputs': {'yaricap': radius},
            'calculations': {
                'hacim': volume,
                'yuzey_alani': surface_area
            },
            'units': {
                'hacim': 'cmÂ³',
                'yuzey_alani': 'cmÂ²'
            },
            'timestamp': datetime.now().isoformat()
        }
        
        self.calculations_history.append(result)
        return result
    
    def save_calculation_to_file(self, result, filename=None):
        """Hesaplama sonucunu dosyaya kaydet"""
        if not filename:
            timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
            filename = f"hesaplama_{result['shape'].lower()}_{timestamp}.txt"
        
        try:
            with open(filename, 'w', encoding='utf-8') as f:
                f.write(f"{result['shape']} Hesaplama SonuÃ§larÄ±\n")
                f.write("=" * 50 + "\n\n")
                f.write(f"Hesaplama Tarihi: {datetime.now().strftime('%d.%m.%Y %H:%M:%S')}\n\n")
                
                f.write("Girilen DeÄŸerler:\n")
                for key, value in result['inputs'].items():
                    f.write(f"  {key.title()}: {value}\n")
                
                f.write("\nHesaplama SonuÃ§larÄ±:\n")
                for key, value in result['calculations'].items():
                    unit = result['units'].get(key, '')
                    if isinstance(value, float):
                        f.write(f"  {key.replace('_', ' ').title()}: {value:.2f} {unit}\n")
                    else:
                        f.write(f"  {key.replace('_', ' ').title()}: {value}\n")
            
            return filename
        except Exception as e:
            print(f"Dosya kaydetme hatasÄ±: {e}")
            return None
    
    def save_history_to_json(self, filename="hesaplama_gecmisi.json"):
        """TÃ¼m hesaplama geÃ§miÅŸini JSON olarak kaydet"""
        try:
            with open(filename, 'w', encoding='utf-8') as f:
                json.dump(self.calculations_history, f, ensure_ascii=False, indent=2)
            return filename
        except Exception as e:
            print(f"JSON kaydetme hatasÄ±: {e}")
            return None
    
    def load_history_from_json(self, filename="hesaplama_gecmisi.json"):
        """JSON dosyasÄ±ndan hesaplama geÃ§miÅŸini yÃ¼kle"""
        try:
            if os.path.exists(filename):
                with open(filename, 'r', encoding='utf-8') as f:
                    self.calculations_history = json.load(f)
                print(f"GeÃ§miÅŸ baÅŸarÄ±yla yÃ¼klendi: {len(self.calculations_history)} kayÄ±t")
            else:
                print(f"Dosya bulunamadÄ±: {filename}")
        except Exception as e:
            print(f"JSON yÃ¼kleme hatasÄ±: {e}")
    
    def print_result(self, result):
        """Hesaplama sonucunu ekrana yazdÄ±r"""
        print(f"\nâœ… {result['shape']} Hesaplama SonuÃ§larÄ±")
        print("=" * 50)
        
        print("\nğŸ“ Girilen DeÄŸerler:")
        for key, value in result['inputs'].items():
            print(f"  â€¢ {key.title()}: {value}")
        
        print("\nğŸ“Š SonuÃ§lar:")
        for key, value in result['calculations'].items():
            unit = result['units'].get(key, '')
            if isinstance(value, float):
                print(f"  â€¢ {key.replace('_', ' ').title()}: {value:.2f} {unit}")
            else:
                print(f"  â€¢ {key.replace('_', ' ').title()}: {value}")
        print()

def main():
    """Ana program"""
    calculator = GeometryCalculator()
    
    # GeÃ§miÅŸ dosyasÄ± varsa yÃ¼kle
    calculator.load_history_from_json()
    
    print("\nğŸ¯ Geometri HesaplayÄ±cÄ±'ya HoÅŸ Geldiniz!")
    print("=" * 50)
    
    while True:
        print("\nğŸ“ Hesaplama SeÃ§enekleri:")
        print("  1ï¸âƒ£  Kare (Alan ve Ã‡evre)")
        print("  2ï¸âƒ£  DikdÃ¶rtgen (Alan ve Ã‡evre)") 
        print("  3ï¸âƒ£  Daire (Alan ve Ã‡evre)")
        print("  4ï¸âƒ£  ÃœÃ§gen (Alan ve Ã‡evre)")
        print("  5ï¸âƒ£  KÃ¼p (Hacim ve YÃ¼zey AlanÄ±)")
        print("  6ï¸âƒ£  KÃ¼re (Hacim ve YÃ¼zey AlanÄ±)")
        print("  7ï¸âƒ£  GeÃ§miÅŸi GÃ¶rÃ¼ntÃ¼le")
        print("  8ï¸âƒ£  GeÃ§miÅŸi Kaydet")
        print("  9ï¸âƒ£  Ã‡Ä±kÄ±ÅŸ")
        
        try:
            choice = input("\nğŸ”¢ SeÃ§iminizi yapÄ±n (1-9): ").strip()
            
            if choice == '1':
                print("\nğŸŸ¦ KARE HESAPLAYICI")
                print("-" * 20)
                side = float(input("Kenar uzunluÄŸunu girin (cm): "))
                result = calculator.calculate_square(side)
                calculator.print_result(result)
                
                save = input("ğŸ’¾ Sonucu dosyaya kaydetmek ister misiniz? (e/h): ")
                if save.lower() == 'e':
                    filename = calculator.save_calculation_to_file(result)
                    if filename:
                        print(f"âœ… SonuÃ§ kaydedildi: {filename}")
            
            elif choice == '2':
                print("\nğŸ“ DÄ°KDÃ–RTGEN HESAPLAYICI")
                print("-" * 25)
                length = float(input("Uzun kenar uzunluÄŸunu girin (cm): "))
                width = float(input("KÄ±sa kenar uzunluÄŸunu girin (cm): "))
                result = calculator.calculate_rectangle(length, width)
                calculator.print_result(result)
                
                save = input("ğŸ’¾ Sonucu dosyaya kaydetmek ister misiniz? (e/h): ")
                if save.lower() == 'e':
                    filename = calculator.save_calculation_to_file(result)
                    if filename:
                        print(f"âœ… SonuÃ§ kaydedildi: {filename}")
            
            elif choice == '3':
                print("\nâ­• DAÄ°RE HESAPLAYICI")
                print("-" * 20)
                radius = float(input("YarÄ±Ã§apÄ± girin (cm): "))
                result = calculator.calculate_circle(radius)
                calculator.print_result(result)
                
                save = input("ğŸ’¾ Sonucu dosyaya kaydetmek ister misiniz? (e/h): ")
                if save.lower() == 'e':
                    filename = calculator.save_calculation_to_file(result)
                    if filename:
                        print(f"âœ… SonuÃ§ kaydedildi: {filename}")
            
            elif choice == '4':
                print("\nğŸ”º ÃœÃ‡GEN HESAPLAYICI")
                print("-" * 20)
                base = float(input("Taban uzunluÄŸunu girin (cm): "))
                height = float(input("YÃ¼ksekliÄŸi girin (cm): "))
                
                calc_perimeter = input("ğŸ¤” Ã‡evre hesaplamak ister misiniz? (e/h): ")
                side1, side2 = None, None
                if calc_perimeter.lower() == 'e':
                    side1 = float(input("Birinci kenar uzunluÄŸunu girin (cm): "))
                    side2 = float(input("Ä°kinci kenar uzunluÄŸunu girin (cm): "))
                
                result = calculator.calculate_triangle(base, height, side1, side2)
                calculator.print_result(result)
                
                save = input("ğŸ’¾ Sonucu dosyaya kaydetmek ister misiniz? (e/h): ")
                if save.lower() == 'e':
                    filename = calculator.save_calculation_to_file(result)
                    if filename:
                        print(f"âœ… SonuÃ§ kaydedildi: {filename}")
            
            elif choice == '5':
                print("\nğŸ§Š KÃœP HESAPLAYICI")
                print("-" * 18)
                side = float(input("Kenar uzunluÄŸunu girin (cm): "))
                result = calculator.calculate_cube(side)
                calculator.print_result(result)
                
                save = input("ğŸ’¾ Sonucu dosyaya kaydetmek ister misiniz? (e/h): ")
                if save.lower() == 'e':
                    filename = calculator.save_calculation_to_file(result)
                    if filename:
                        print(f"âœ… SonuÃ§ kaydedildi: {filename}")
            
            elif choice == '6':
                print("\nğŸŒ KÃœRE HESAPLAYICI")
                print("-" * 20)
                radius = float(input("YarÄ±Ã§apÄ± girin (cm): "))
                result = calculator.calculate_sphere(radius)
                calculator.print_result(result)
                
                save = input("ğŸ’¾ Sonucu dosyaya kaydetmek ister misiniz? (e/h): ")
                if save.lower() == 'e':
                    filename = calculator.save_calculation_to_file(result)
                    if filename:
                        print(f"âœ… SonuÃ§ kaydedildi: {filename}")
            
            elif choice == '7':
                if calculator.calculations_history:
                    print("\nğŸ“Š HESAPLAMA GEÃ‡MÄ°ÅÄ°")
                    print("=" * 60)
                    for i, calc in enumerate(calculator.calculations_history, 1):
                        print(f"\n{i}. {calc['shape']} - {calc['timestamp'][:19].replace('T', ' ')}")
                        for key, value in calc['calculations'].items():
                            unit = calc['units'].get(key, '')
                            if isinstance(value, float):
                                print(f"   â€¢ {key.replace('_', ' ').title()}: {value:.2f} {unit}")
                            else:
                                print(f"   â€¢ {key.replace('_', ' ').title()}: {value}")
                else:
                    print("\nâŒ HenÃ¼z hesaplama yapÄ±lmamÄ±ÅŸ.")
            
            elif choice == '8':
                if calculator.calculations_history:
                    filename = calculator.save_history_to_json()
                    if filename:
                        print(f"âœ… GeÃ§miÅŸ kaydedildi: {filename}")
                        print(f"ğŸ“ˆ Toplam {len(calculator.calculations_history)} hesaplama kaydedildi")
                else:
                    print("âŒ Kaydedilecek geÃ§miÅŸ bulunamadÄ±.")
            
            elif choice == '9':
                print("\nğŸ‘‹ Program sonlandÄ±rÄ±lÄ±yor...")
                print("HesaplayÄ±cÄ±yÄ± kullandÄ±ÄŸÄ±nÄ±z iÃ§in teÅŸekkÃ¼rler!")
                
                # Ã‡Ä±kÄ±ÅŸ Ã¶ncesi otomatik kaydet
                if calculator.calculations_history:
                    calculator.save_history_to_json()
                    print("ğŸ’¾ GeÃ§miÅŸ otomatik olarak kaydedildi.")
                
                break
            
            else:
                print("\nâŒ GeÃ§ersiz seÃ§im! LÃ¼tfen 1-9 arasÄ± bir sayÄ± girin.")
        
        except ValueError as e:
            print(f"\nâŒ Hata: {e}")
            print("ğŸ’¡ LÃ¼tfen geÃ§erli bir sayÄ± girin.")
        except KeyboardInterrupt:
            print("\n\nğŸ‘‹ Program kullanÄ±cÄ± tarafÄ±ndan sonlandÄ±rÄ±ldÄ±.")
            break
        except Exception as e:
            print(f"\nâŒ Beklenmeyen hata: {e}")
            print("ğŸ”„ Programa devam ediliyor...")

# Flask Web Servisi
try:
    from flask import Flask, request, jsonify, send_from_directory
    from flask_cors import CORS
    
    def create_web_app():
        """Flask web uygulamasÄ± oluÅŸtur"""
        app = Flask(__name__)
        CORS(app)
        calculator = GeometryCalculator()
        
        @app.route('/')
        def index():
            """Ana sayfa"""
            try:
                return send_from_directory('.', 'geometry_calculator.html')
            except:
                return """
                <h1>Geometri HesaplayÄ±cÄ± API</h1>
                <p>geometry_calculator.html dosyasÄ± bulunamadÄ±.</p>
                <p>API Endpoints:</p>
                <ul>
                    <li>POST /api/calculate</li>
                    <li>GET /api/history</li>
                    <li>POST /api/save</li>
                </ul>
                """
        
        @app.route('/api/calculate', methods=['POST'])
        def api_calculate():
            """API hesaplama endpoint'i"""
            try:
                data = request.json
                shape = data.get('shape')
                
                if shape == 'square':
                    result = calculator.calculate_square(data['side'])
                elif shape == 'rectangle':
                    result = calculator.calculate_rectangle(data['length'], data['width'])
                elif shape == 'circle':
                    result = calculator.calculate_circle(data['radius'])
                elif shape == 'triangle':
                    result = calculator.calculate_triangle(
                        data['base'], data['height'], 
                        data.get('side1'), data.get('side2')
                    )
                elif shape == 'cube':
                    result = calculator.calculate_cube(data['side'])
                elif shape == 'sphere':
                    result = calculator.calculate_sphere(data['radius'])
                else:
                    return jsonify({'error': 'GeÃ§ersiz ÅŸekil'}), 400
                
                return jsonify(result)
            
            except ValueError as e:
                return jsonify({'error': str(e)}), 400
            except KeyError as e:
                return jsonify({'error': f'Eksik parametre: {str(e)}'}), 400
            except Exception as e:
                return jsonify({'error': f'Beklenmeyen hata: {str(e)}'}), 500
        
        @app.route('/api/history', methods=['GET'])
        def api_history():
            """Hesaplama geÃ§miÅŸini dÃ¶ndÃ¼r"""
            return jsonify({
                'history': calculator.calculations_history,
                'count': len(calculator.calculations_history)
            })
        
        @app.route('/api/save', methods=['POST'])
        def api_save():
            """Hesaplama sonucunu dosyaya kaydet"""
            try:
                data = request.json
                filename = calculator.save_calculation_to_file(data)
                if filename:
                    return jsonify({
                        'filename': filename, 
                        'message': 'BaÅŸarÄ±yla kaydedildi'
                    })
                else:
                    return jsonify({'error': 'Kaydetme iÅŸlemi baÅŸarÄ±sÄ±z'}), 500
            except Exception as e:
                return jsonify({'error': str(e)}), 500
        
        return app
    
    def run_web_server():
        """Web sunucusunu baÅŸlat"""
        app = create_web_app()
        print("\nğŸŒ Web sunucusu baÅŸlatÄ±lÄ±yor...")
        print("ğŸ“± TarayÄ±cÄ±nÄ±zda ÅŸu adresi aÃ§Ä±n: http://127.0.0.1:5000")
        print("ğŸ›‘ Sunucuyu durdurmak iÃ§in Ctrl+C basÄ±n")
        try:
            app.run(debug=True, host='127.0.0.1', port=5000)
        except KeyboardInterrupt:
            print("\nğŸ‘‹ Web sunucusu durduruldu.")

except ImportError:
    print("âš ï¸  Flask kurulu deÄŸil. Web servisi kullanÄ±lamaz.")
    print("ğŸ“¦ Flask kurmak iÃ§in: pip install flask flask-cors")
    
    def run_web_server():
        print("âŒ Flask kurulu deÄŸil. Web servisi baÅŸlatÄ±lamÄ±yor.")
        print("ğŸ“¦ Kurulum: pip install flask flask-cors")

if __name__ == "__main__":
    if len(sys.argv) > 1 and sys.argv[1] == 'web':
        run_web_server()
    else:
        main()
